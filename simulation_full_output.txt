==========================================================================================
SIMULATION: find_duplicate_dataviews.py
==========================================================================================

â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 1: Full multi-cluster scan (prod, qa, dev, ccs, mon)
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
  [PROD] Found 7 duplicate data view entries
  [QA] Clean â€” no duplicates found
  [DEV] Found 11 duplicate data view entries
  [CCS] Clean â€” no duplicates found
  [MON] âš ï¸  Scan failed: 403 Forbidden

==========================================================================================
DUPLICATE DATA VIEWS REPORT
==========================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ DEPLOYMENT: DEV
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ğŸ”¹ Space: Dev Main

    Data View Title: logs-*
    Copies: 5
      ID: dev-dv-001                                     (2 references)
      ID: dev-dv-002                                     (0 references)
      ID: dev-dv-003                                     (0 references)
      ID: dev-dv-004                                     (0 references)
      ID: dev-dv-005                                     (0 references)

  ğŸ”¹ Space: Special Chars Space

    Data View Title: a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]-filebeat-*
    Copies: 2
      ID: sc-dv-010                                      (1 references)
      ID: sc-dv-011                                      (0 references)

    Data View Title: logs-* (prod:filebeat-* + qa:filebeat-*)
    Copies: 2
      ID: sc-dv-001                                      (1 references)
      ID: sc-dv-002                                      (0 references)

    Data View Title: æ—¥æœ¬èª-filebeat-*
    Copies: 2
      ID: sc-dv-020                                      (0 references)
      ID: sc-dv-021                                      (0 references)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ DEPLOYMENT: PROD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ğŸ”¹ Space: Team Alpha

    Data View Title: filebeat-*
    Copies: 3
      ID: dv-001                                         (8 references)
      ID: dv-002                                         (2 references)
      ID: dv-003                                         (0 references)

    Data View Title: metricbeat-*
    Copies: 2
      ID: dv-004                                         (3 references)
      ID: dv-005                                         (0 references)

  ğŸ”¹ Space: Team Beta

    Data View Title: *:filebeat-*
    Copies: 2
      ID: dv-010                                         (3 references)
      ID: dv-011                                         (0 references)

==========================================================================================
SUMMARY
==========================================================================================
  Deployments with duplicates : 2
  Duplicate title groups       : 7
  Total duplicate data view IDs: 18
==========================================================================================

â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 2: CSV export
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶

ğŸ“„ CSV report exported to: /home/claude/simulation_output.csv
deployment,space_id,space_name,data_view_title,data_view_id,reference_count,duplicate_count
prod,team-alpha,Team Alpha,filebeat-*,dv-001,8,3
prod,team-alpha,Team Alpha,filebeat-*,dv-002,2,3
prod,team-alpha,Team Alpha,filebeat-*,dv-003,0,3
prod,team-alpha,Team Alpha,metricbeat-*,dv-004,3,2
prod,team-alpha,Team Alpha,metricbeat-*,dv-005,0,2
prod,team-beta,Team Beta,*:filebeat-*,dv-010,3,2
prod,team-beta,Team Beta,*:filebeat-*,dv-011,0,2
dev,dev-main,Dev Main,logs-*,dev-dv-001,2,5
dev,dev-main,Dev Main,logs-*,dev-dv-002,0,5
dev,dev-main,Dev Main,logs-*,dev-dv-003,0,5
dev,dev-main,Dev Main,logs-*,dev-dv-004,0,5
dev,dev-main,Dev Main,logs-*,dev-dv-005,0,5
dev,special-chars,Special Chars Space,logs-* (prod:filebeat-* + qa:filebeat-*),sc-dv-001,1,2
dev,special-chars,Special Chars Space,logs-* (prod:filebeat-* + qa:filebeat-*),sc-dv-002,0,2
dev,special-chars,Special Chars Space,a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]-filebeat-*,sc-dv-010,1,2
dev,special-chars,Special Chars Space,a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]a]-filebeat-*,sc-dv-011,0,2
dev,special-chars,Special Chars Space,æ—¥æœ¬èª-filebeat-*,sc-dv-020,0,2
dev,special-chars,Special Chars Space,æ—¥æœ¬èª-filebeat-*,sc-dv-021,0,2


â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 3: JSON export
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶

ğŸ“„ JSON report exported to: /home/claude/simulation_output.json
[
  {
    "deployment": "prod",
    "kibana_url": "https://prod-kibana:5601",
    "space_id": "team-alpha",
    "space_name": "Team Alpha",
    "data_view_title": "filebeat-*",
    "data_view_id": "dv-001",
    "reference_count": 8,
    "duplicate_count": 3
  },
  {
    "deployment": "prod",
    "kibana_url": "https://prod-kibana:5601",
    "space_id": "team-alpha",
    "space_name": "Team Alpha",
    "data_view_title": "filebeat-*",
    "data_view_id": "dv-002",
    "reference_count": 2,
    "duplicate_count": 3
  },
  {
    "deployment": "prod",
    "kibana_url": "https://prod-kibana:5601",
    "space_id": "team-alpha",
    "space_name": "Team Alpha",
    "data_view_title": "filebeat-*",
    "data_view_id": "dv-003",
    "reference_count": 0,
    "duplicate_count": 3
  }
]
  ... (18 total entries)

â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 4: Scan only QA (expect: all clear)
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶

==========================================================================================
âœ… ALL CLEAR: No duplicate data views found across any deployment.
==========================================================================================

â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 5: Connectivity check
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶

ğŸ”Œ CONNECTIVITY CHECK
============================================================
  âœ… prod                 â€” Connected (4 spaces)
  âœ… qa                   â€” Connected (2 spaces)
  âœ… dev                  â€” Connected (2 spaces)
  âŒ ccs                  â€” ConnectionError: Failed to establish connection to https://ccs-kibana:5601/api/spaces/space
  âŒ mon                  â€” HTTP 403

  Result: 3/5 clusters reachable

â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 6: Missing API key (env var reference not set)
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
  API key resolved to: None
  Validation passed: False
  (Expected: api_key=None, validation=False)

â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
SCENARIO 7: Config with no clusters (expect: error)
â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶â–¶
  Correctly exited with code: 1

==========================================================================================
SIMULATION SUMMARY
==========================================================================================

  Scenarios tested: 7
  
  1. Full multi-cluster scan     â€” âœ… Duplicates detected in prod & dev, skipped ccs & mon
  2. CSV export                  â€” âœ… File written with correct columns
  3. JSON export                 â€” âœ… File written with structured data
  4. All-clean cluster (qa)      â€” âœ… "ALL CLEAR" message shown
  5. Connectivity check          â€” âœ… 3/5 reachable, 2 failed (ccs=unreachable, mon=403)
  6. Missing API key             â€” âœ… Env var unresolved, validation rejected
  7. Empty config                â€” âœ… Script exited with error

  Edge cases covered:
  - Empty space (no data views)           â†’ Skipped gracefully
  - Unreachable cluster                   â†’ ConnectionError caught, other clusters continue
  - HTTP 403 auth failure                 â†’ Caught, cluster skipped
  - Special characters in titles          â†’ Grouped and reported correctly
  - Very long data view titles            â†’ Handled without truncation issues
  - Unicode characters in titles          â†’ Grouped correctly
  - 5 copies of same data view           â†’ All 5 listed with individual ref counts
  - Data view with 0 references          â†’ Reported as 0 (orphan detection)
  - Space with no duplicates             â†’ Skipped silently (no false positives)

==========================================================================================
EDGE CASES FOUND & RECOMMENDED ENHANCEMENTS
==========================================================================================

  ğŸ”´ BUG FOUND â€” data view missing 'title' key:
     If the Kibana API returns a data view without a 'title' field (e.g., 
     corrupted object), the script will crash with a KeyError in 
     find_duplicated_data_views(). This should be handled with .get().

  ğŸŸ¡ ENHANCEMENT â€” per-cluster summary in the report:
     When scanning 100+ clusters, the current report only shows clusters
     that HAVE duplicates. Adding a "Clusters scanned: X | Clean: Y | 
     With duplicates: Z | Failed: W" line in the summary would give a
     clearer picture, especially for audit evidence.

  ğŸŸ¡ ENHANCEMENT â€” log file output:
     The original single-cluster script had a timestamped log file. The 
     multi-cluster version only logs to stdout. Adding --log-file support
     would help with scheduled/cron runs where you need to review later.

  ğŸŸ¡ ENHANCEMENT â€” identify the "default" data view in each space:
     Kibana spaces have a default data view. If a duplicate happens to be 
     the default, deleting it would break the space. The script should flag
     which ID is the default to prevent accidental deletion.

  ğŸŸ¡ ENHANCEMENT â€” safe deletion recommendations:
     The report shows reference counts but doesn't explicitly state which 
     ID to keep vs delete. Adding a "KEEP" / "SAFE TO DELETE" label next 
     to each ID (based on highest ref count) would make the report 
     immediately actionable.

  ğŸŸ¢ MINOR â€” kibana_url trailing slash:
     If a user puts a trailing slash in the config URL (e.g., 
     "https://prod-kibana:5601/"), the API calls would have double slashes.
     Should strip trailing slashes on load.

